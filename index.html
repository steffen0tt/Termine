<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title><p>Kita-Termine<br>2025</title>
<style>
  :root{
    --bg:#fbfbfd;
    --card:#ffffff;
    --text:#263238;
    --muted:#61717a;
    --accent:#0066c0;
    --radius:14px;
    --padding:18px;
    --gap:16px;
    --pastel-blue: #d8eefe;
    --pastel-red: #ffd9d9;
    --pastel-green: #e6f7ea;
    --pastel-orange: #fff0da;
    --pastel-purple: #f3e9ff;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  header{
    background: linear-gradient(90deg,#6fb1ff,#9bd1ff);
    padding:28px 16px;
    text-align:center;
    border-bottom-left-radius:18px;
    border-bottom-right-radius:18px;
    color:white;
  }
  header h1{
    margin:0;
    font-size:1.6rem;
    letter-spacing:0.2px;
  }
  header p{
    margin:10px 0 0;
    opacity:0.95;
    font-size:0.95rem;
  }
  header .sub{
    font-size:0.9rem;
    opacity:0.95;
  }

  main{
    max-width:1100px;
    margin:20px auto;
    padding:18px;
  }

  /* month section */
  .month {
    margin-bottom:26px;
  }
  .month h2{
    margin:6px 6px 12px;
    font-size:1.05rem;
    color:#233444;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .month h2 .dot{
    width:10px;height:10px;border-radius:50%;
    background:var(--accent);
    display:inline-block;
    transform:translateY(1px);
  }

  /* grid of cards */
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
    gap:var(--gap);
  }

  .card{
    background:var(--card);
    border-radius:var(--radius);
    padding:14px;
    box-shadow:0 6px 18px rgba(20,40,60,0.06);
    display:flex;
    flex-direction:column;
    gap:10px;
    transition:transform .14s ease, box-shadow .14s ease;
    min-height:120px;
  }
  .card:hover{ transform:translateY(-6px); box-shadow:0 14px 30px rgba(20,40,60,0.08); }

  .row {
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
  }

  .title{
    font-weight:600;
    font-size:1rem;
    color:var(--text);
  }
  .meta{
    font-size:0.92rem;
    color:var(--muted);
  }

  .time {
    font-weight:700;
    color:#223344;
  }

  .pill{
    padding:6px 10px;
    border-radius:999px;
    font-size:0.78rem;
    font-weight:600;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }

  .type-parents { background: var(--pastel-blue); color:#064b8b; }
  .type-closed  { background: var(--pastel-red);  color:#8b1d1d; }
  .type-party   { background: var(--pastel-green); color:#13522a; }
  .type-info    { background: var(--pastel-orange); color:#6a3f00; }
  .type-other   { background: var(--pastel-purple); color:#4b2a7a; }

  .buttons{
    margin-top:auto;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .btn{
    background:linear-gradient(180deg,#ffffff, #f6f8ff);
    border:1px solid rgba(0,0,0,0.06);
    padding:8px 12px;
    border-radius:10px;
    font-weight:600;
    font-size:0.9rem;
    color:var(--accent);
    text-decoration:none;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  .btn-ical{ background:linear-gradient(180deg,#fff,#f7fff8); color:#0a7a3f; border-color:rgba(10,122,63,0.12) }
  .btn-google{ background:linear-gradient(180deg,#fff,#f2f6ff); color:#134f9c; border-color:rgba(19,79,156,0.12) }
  .btn:active{ transform:translateY(1px); }

  footer{
    text-align:center;
    color:var(--muted);
    font-size:0.9rem;
    margin:28px auto 60px;
  }

  /* small screens */
  @media (max-width:520px){
    header h1{ font-size:1.2rem; }
    .card{ padding:12px; }
    main{ padding:12px; }
  }
</style>
</head>
<body>

<header>
  <h1>🧡 Kita-Termine 2025</h1>
  <p class="sub">Freundliche Übersicht — Monatsweise gegliedert · iCal (Europe/Berlin) & Google-Links</p>
  <p style="margin-top:10px"><a id="feed-link" href="#" style="color: rgba(255,255,255,0.95); text-decoration:underline;">📥 Alle Termine als iCal abonnieren</a></p>
</header>

<main id="main"></main>

<footer>© Kita · Stand: 2025 · Zeitzone: <strong>Europe/Berlin</strong></footer>

<script>
/* -------------------------
   Daten: Termine mit Typ
   ------------------------- */
const rawEvents = [
  // title, start, end, type
  ["Neujahrskonzert", "2025-01-25T15:00:00", "2025-01-25T17:00:00", "party"],
  ["Elternabend Flötenfohlen", "2025-02-05T18:00:00", "2025-02-05T19:00:00", "parents"],
  ["Elternabend Trompetentiger", "2025-02-06T18:00:00", "2025-02-06T19:00:00", "parents"],
  ["Elternabend Klangkobolde", "2025-02-12T18:00:00", "2025-02-12T19:00:00", "parents"],
  ["Elternabend Klavierschildkröten", "2025-02-13T18:00:00", "2025-02-13T19:00:00", "parents"],
  ["Elternrat", "2025-02-19T18:00:00", "2025-02-19T19:00:00", "info"],
  ["Fasching", "2025-02-19", "2025-02-19", "party"],
  ["Kita geschlossen! Konzepttag", "2025-02-21", "2025-02-21", "closed"],
  ["Elternabend Melodiezauberer", "2025-02-27T18:00:00", "2025-02-27T19:00:00", "parents"],
  ["Elternabend Musikwichtel", "2025-03-06T18:00:00", "2025-03-06T19:00:00", "parents"],
  ["Kita geschlossen! Konzepttag", "2025-04-07", "2025-04-07", "closed"],
  ["Kita geschlossen! Regenerationstag", "2025-05-02", "2025-05-02", "closed"],
  ["Elternrat", "2025-05-21T18:00:00", "2025-05-21T19:00:00", "info"],
  ["Kita geschlossen! Betriebsausflug", "2025-06-20", "2025-06-20", "closed"],
  ["Sommerfest (Betreuung bis 13 Uhr)", "2025-06-27T15:00:00", "2025-06-27T17:00:00", "party"],
  ["Verabschiedung Brückenjahr", "2025-07-04", "2025-07-04", "party"],
  ["Kita geschlossen! Sommerschließzeit", "2025-08-04", "2025-08-15", "closed"],
  ["Elternabend Flötenfohlen", "2025-09-10T18:00:00", "2025-09-10T19:00:00", "parents"],
  ["Elternabend Trompetentiger", "2025-09-11T18:00:00", "2025-09-11T19:00:00", "parents"],
  ["Elternabend Klavierschildkröten", "2025-09-17T18:00:00", "2025-09-17T19:00:00", "parents"],
  ["Elternabend Melodiezauberer & Musikwichtel & Klangkobolde", "2025-09-18T18:00:00", "2025-09-18T19:00:00", "parents"],
  ["Elternrat", "2025-09-24T18:00:00", "2025-09-24T19:00:00", "info"],
  ["Kita geschlossen! Tag der mittelbaren Pädagogik", "2025-09-26", "2025-09-26", "closed"],
  ["Kita geschlossen! Regenerationstag", "2025-10-06", "2025-10-06", "closed"],
  ["Herbstbasteln Klavierschildkröten", "2025-11-04T15:00:00", "2025-11-04T17:00:00", "party"],
  ["Herbstbasteln Trompetentiger", "2025-11-05T15:00:00", "2025-11-05T17:00:00", "party"],
  ["Herbstbasteln Flötenfohlen", "2025-11-06T15:00:00", "2025-11-06T17:00:00", "party"],
  ["Info-Nachmittag Brückenjahr", "2025-11-11T15:00:00", "2025-11-11T17:00:00", "info"],
  ["Elternrat", "2025-11-12T18:00:00", "2025-11-12T19:00:00", "info"],
  ["Kita geschlossen! Tag der Hamburger Richtlinien", "2025-11-14", "2025-11-14", "closed"],
  ["Lichterfest", "2025-11-21T18:00:00", "2025-11-21T19:00:00", "party"],
  ["Adventssingen Musikwichtel & Klavierschildkröten", "2025-12-09T18:00:00", "2025-12-09T19:00:00", "party"],
  ["Adventssingen Melodiezauberer & Flötenfohlen", "2025-12-10T18:00:00", "2025-12-10T19:00:00", "party"],
  ["Adventssingen Klangkobolde & Trompetentiger", "2025-12-11T18:00:00", "2025-12-11T19:00:00", "party"],
  ["Kita geschlossen! Winterschließzeit", "2025-12-24", "2026-01-02", "closed"]
];

/* map into objects and normalize */
const events = rawEvents.map(([title, start, end, type]) => ({
  title, start, end, type
}));

/* helper: parse dates (keep as local strings but ICS will be Europe/Berlin) */
function toDate(s){
  // s may be "YYYY-MM-DD" or "YYYY-MM-DDTHH:MM:SS"
  return s.includes("T") ? new Date(s) : new Date(s + "T00:00:00");
}

/* group by month-year text */
function monthKey(dt){
  return dt.toLocaleString("de-DE", { month: "long", year: "numeric" });
}

/* sort events by start date */
events.sort((a,b)=> toDate(a.start) - toDate(b.start));

/* build grouped structure */
const months = {};
events.forEach(ev=>{
  const dt = toDate(ev.start);
  const key = monthKey(dt);
  months[key] = months[key] || [];
  months[key].push(ev);
});

/* type meta for display */
const typeMeta = {
  parents: { label:"Elternabend", cls:"type-parents", emoji:"👩‍🏫" },
  closed:  { label:"Kita geschlossen", cls:"type-closed",  emoji:"🚫" },
  party:   { label:"Fest / Basteln", cls:"type-party",   emoji:"🎉" },
  info:    { label:"Elternrat / Info", cls:"type-info",  emoji:"👥" },
  other:   { label:"Sonstiges", cls:"type-other", emoji:"✨" }
};

/* format helpers for display */
function displayDateRange(ev){
  const s = toDate(ev.start);
  const e = toDate(ev.end);
  const sameDay = s.toDateString() === e.toDateString();
  if(sameDay){
    const day = s.toLocaleDateString("de-DE", { weekday:"short", day:"2-digit", month:"2-digit", year:"numeric" });
    return day;
  } else {
    const from = s.toLocaleDateString("de-DE", { day:"2-digit", month:"2-digit", year:"numeric" });
    const to = e.toLocaleDateString("de-DE", { day:"2-digit", month:"2-digit", year:"numeric" });
    return `${from} – ${to}`;
  }
}
function displayTime(ev){
  if(ev.start.includes("T")){
    const s = toDate(ev.start);
    const e = toDate(ev.end);
    return `${s.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})} – ${e.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}`;
  } else {
    return "ganztägig";
  }
}

/* ICS formatting helpers (Europe/Berlin) */
function toICSDateTimeLocal(s){
  // input: "YYYY-MM-DD" or "YYYY-MM-DDTHH:MM:SS"
  // output: YYYYMMDDTHHMMSS (no Z) for use with DTSTART;TZID=Europe/Berlin
  if(!s.includes("T")){
    // all-day event -> we will handle as VALUE=DATE elsewhere
    return s.replace(/-/g,"");
  }
  // ensure seconds exist
  const d = new Date(s);
  const y = d.getFullYear().toString().padStart(4,"0");
  const mo = (d.getMonth()+1).toString().padStart(2,"0");
  const da = d.getDate().toString().padStart(2,"0");
  const hh = d.getHours().toString().padStart(2,"0");
  const mm = d.getMinutes().toString().padStart(2,"0");
  const ss = d.getSeconds().toString().padStart(2,"0");
  return `${y}${mo}${da}T${hh}${mm}${ss}`;
}

/* Create VEVENT string with timezone Europe/Berlin
   For all-day events we use DTSTART;VALUE=DATE:YYYYMMDD and DTEND;VALUE=DATE:YYYYMMDD (exclusive)
*/
function createVEvent(ev){
  const uid = `${Date.now()}-${Math.random().toString(36).slice(2,9)}@kitatermine.local`;
  const dtstamp = toICSDateTimeLocal(new Date().toISOString());
  if(!ev.start.includes("T")){
    // all-day: ICS uses DTEND as exclusive end -> add 1 day to ev.end
    const startYMD = ev.start.replace(/-/g,"");
    const endDate = new Date(ev.end + "T00:00:00");
    endDate.setDate(endDate.getDate() + 1);
    const endYMD = endDate.toISOString().slice(0,10).replace(/-/g,"");
    return [
      "BEGIN:VEVENT",
      `UID:${uid}`,
      `DTSTAMP:${dtstamp}`,
      `DTSTART;VALUE=DATE:${startYMD}`,
      `DTEND;VALUE=DATE:${endYMD}`,
      `SUMMARY:${ev.title}`,
      "END:VEVENT"
    ].join("\r\n");
  } else {
    const dtStart = toICSDateTimeLocal(ev.start);
    const dtEnd   = toICSDateTimeLocal(ev.end);
    return [
      "BEGIN:VEVENT",
      `UID:${uid}`,
      `DTSTAMP:${dtstamp}`,
      `DTSTART;TZID=Europe/Berlin:${dtStart}`,
      `DTEND;TZID=Europe/Berlin:${dtEnd}`,
      `SUMMARY:${ev.title}`,
      "END:VEVENT"
    ].join("\r\n");
  }
}

/* Build global ICS content */
function buildGlobalICS(){
  const vevents = events.map(createVEvent).join("\r\n");
  return [
    "BEGIN:VCALENDAR",
    "VERSION:2.0",
    "PRODID:-//Kita-Termine//DE",
    "CALSCALE:GREGORIAN",
    "METHOD:PUBLISH",
    vevents,
    "END:VCALENDAR"
  ].join("\r\n");
}

/* Build per-event ICS data URL */
function buildEventICSDataUrl(ev){
  const content = [
    "BEGIN:VCALENDAR",
    "VERSION:2.0",
    "PRODID:-//Kita-Termine//DE",
    createVEvent(ev),
    "END:VCALENDAR"
  ].join("\r\n");
  return "data:text/calendar;charset=utf-8," + encodeURIComponent(content);
}

/* Build Google Calendar link
   For timed events: dates=YYYYMMDDTHHMMSS/YYYYMMDDTHHMMSS & ctz=Europe/Berlin
   For all-day: dates=YYYYMMDD/YYYYMMDD (end exclusive -> +1 day)
*/
function buildGoogleUrl(ev){
  if(!ev.start.includes("T")){
    const startYMD = ev.start.replace(/-/g,"");
    const endDate = new Date(ev.end + "T00:00:00"); endDate.setDate(endDate.getDate()+1);
    const endYMD = endDate.toISOString().slice(0,10).replace(/-/g,"");
    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title)}&dates=${startYMD}/${endYMD}&ctz=Europe/Berlin`;
  } else {
    const s = toICSDateTimeLocal(ev.start);
    const e = toICSDateTimeLocal(ev.end);
    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title)}&dates=${s}/${e}&ctz=Europe/Berlin`;
  }
}

/* RENDERING: build DOM */
const main = document.getElementById("main");

Object.keys(months).forEach(monthName => {
  const section = document.createElement("section");
  section.className = "month";
  const h = document.createElement("h2");
  h.innerHTML = `<span class="dot"></span> ${monthName.charAt(0).toUpperCase()+monthName.slice(1)}`;
  section.appendChild(h);

  const grid = document.createElement("div");
  grid.className = "grid";

  months[monthName].forEach(ev => {
    const card = document.createElement("article");
    card.className = "card";

    const metaRow = document.createElement("div");
    metaRow.className = "row";

    const left = document.createElement("div");
    left.style.flex = "1";

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = ev.title;

    const date = document.createElement("div");
    date.className = "meta";
    date.textContent = displayDateRange(ev);

    left.appendChild(title);
    left.appendChild(date);

    const right = document.createElement("div");
    right.style.textAlign = "right";

    // type pill
    const t = typeMeta[ev.type] || typeMeta.other;
    const pill = document.createElement("div");
    pill.className = `pill ${t.cls}`;
    pill.innerHTML = `<span style="font-size:1.05rem">${t.emoji}</span> <span style="opacity:0.95">${t.label}</span>`;

    right.appendChild(pill);

    metaRow.appendChild(left);
    metaRow.appendChild(right);

    const timeRow = document.createElement("div");
    timeRow.className = "row";
    const timeDiv = document.createElement("div");
    timeDiv.className = "time";
    timeDiv.textContent = displayTime(ev);

    timeRow.appendChild(timeDiv);

    // Buttons
    const buttons = document.createElement("div");
    buttons.className = "buttons";

    const aIcal = document.createElement("a");
    aIcal.className = "btn btn-ical";
    aIcal.href = buildEventICSDataUrl(ev);
    // safe file name
    const fileName = ev.title.replace(/[^\w\d\-_]+/g,"_");
    aIcal.setAttribute("download", `${fileName}.ics`);
    aIcal.innerHTML = "📅 iCal";

    const aGoogle = document.createElement("a");
    aGoogle.className = "btn btn-google";
    aGoogle.href = buildGoogleUrl(ev);
    aGoogle.target = "_blank";
    aGoogle.rel = "noopener noreferrer";
    aGoogle.innerHTML = "📆 Google";

    buttons.appendChild(aIcal);
    buttons.appendChild(aGoogle);

    card.appendChild(metaRow);
    card.appendChild(timeRow);
    card.appendChild(buttons);

    grid.appendChild(card);
  });

  section.appendChild(grid);
  main.appendChild(section);
});

/* Global ICS feed: attach to header link as data URL (so people can subscribe by copying the link).
   Note: for a permanent URL (recommended) upload a real .ics file to your server or GitHub Pages.
*/
const globalICS = buildGlobalICS();
const dataUrl = "data:text/calendar;charset=utf-8," + encodeURIComponent(globalICS);
document.getElementById("feed-link").href = dataUrl;
document.getElementById("feed-link").setAttribute("download","kita_termine_2025.ics");

/* Extra: provide console hint */
console.info("Kita-Termine geladen. Global ICS data URL is set on the header link (Europe/Berlin).");
</script>
</body>
</html>
