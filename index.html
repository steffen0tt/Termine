<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kita-Termine 2025</title>
<style>
:root{
  --bg:#fbfbfd; --card:#ffffff; --text:#263238; --muted:#61717a; --accent:#0066c0;
  --radius:14px; --padding:18px; --gap:16px; --pastel-blue: #d8eefe;
  --pastel-red: #ffd9d9; --pastel-green: #e6f7ea; --pastel-orange: #fff0da; --pastel-purple: #f3e9ff;
}
*{box-sizing:border-box}
body{ margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text); }
header{ background: linear-gradient(90deg,#6fb1ff,#9bd1ff); padding:28px 16px; text-align:center; border-bottom-left-radius:18px; border-bottom-right-radius:18px; color:white; }
header h1{ margin:0; font-size:1.6rem; }
header p{ margin:10px 0 0; opacity:0.95; font-size:0.95rem; }
nav{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:14px; }
.filter-btn{ background:white; border-radius:999px; padding:8px 12px; font-weight:700; border:1px solid rgba(0,0,0,0.06); cursor:pointer; }
.filter-btn.active{
  background:#0066c0; color:white;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  transform:translateY(-2px);
}
main{ max-width:1100px; margin:20px auto; padding:18px; }
.month { margin-bottom:26px; }
.month h2{ margin:6px 6px 12px; font-size:1.05rem; color:#233444; display:flex; align-items:center; gap:8px; }
.grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:var(--gap); }
.card{ background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:0 6px 18px rgba(20,40,60,0.06); display:flex; flex-direction:column; gap:10px; transition:transform .14s ease; min-height:120px; }
.card:hover{ transform:translateY(-6px); box-shadow:0 14px 30px rgba(20,40,60,0.08); }
.row { display:flex; justify-content:space-between; align-items:flex-start; gap:10px; }
.title{ font-weight:600; font-size:1rem; color:var(--text); }
.meta{ font-size:0.92rem; color:var(--muted); }
.time { font-weight:700; color:#223344; }
.pill{ padding:6px 10px; border-radius:999px; font-size:0.78rem; font-weight:600; display:inline-flex; gap:8px; align-items:center; }
.type-parents { background: var(--pastel-blue); color:#064b8b; }
.type-closed { background: var(--pastel-red); color:#8b1d1d; }
.type-party { background: var(--pastel-green); color:#13522a; }
.type-info { background: var(--pastel-orange); color:#6a3f00; }
.type-other { background: var(--pastel-purple); color:#4b2a7a; }
.buttons{ margin-top:auto; display:flex; gap:8px; flex-wrap:wrap; }
.btn{ background:linear-gradient(180deg,#ffffff, #f6f8ff); border:1px solid rgba(0,0,0,0.06); padding:8px 12px; border-radius:10px; font-weight:600; font-size:0.9rem; color:var(--accent); text-decoration:none; display:inline-flex; gap:8px; align-items:center; }
.btn-ical{ background:linear-gradient(180deg,#fff,#f7fff8); color:#0a7a3f; border-color:rgba(10,122,63,0.12) }
.btn-google{ background:linear-gradient(180deg,#fff,#f2f6ff); color:#134f9c; border-color:rgba(19,79,156,0.12) }
footer{ text-align:center; color:var(--muted); font-size:0.9rem; margin:28px auto 60px; }
@media (max-width:520px){ header h1{ font-size:1.2rem; } .card{ padding:12px; } main{ padding:12px; } }
</style>
</head>
<body>
<header>
<h1>üß° Kita-Termine 2025</h1>
<p class="sub">Monats√ºbersicht ¬∑ iCal (Europe/Berlin) mit Erinnerung 2 Tage vorher ¬∑ Filter nach Gruppe</p>
<div style="margin-top:12px">
  <a id="feed-download" href="#" style="color:rgba(255,255,255,0.95); text-decoration:underline; margin-right:16px;">üì• Alle Termine als iCal</a>
</div>
<nav id="filters" aria-label="Gruppen Filter" style="margin-top:14px">
  <button class="filter-btn active" data-group="all">üåç Alle</button>
  <button class="filter-btn" data-group="Klavierschildkr√∂ten">üê¢ Klavierschildkr√∂ten</button>
  <button class="filter-btn" data-group="Klangkobolde">üßö Klangkobolde</button>
  <button class="filter-btn" data-group="Trompetentiger">üêØ Trompetentiger</button>
  <button class="filter-btn" data-group="Fl√∂tenfohlen">üê¥ Fl√∂tenfohlen</button>
  <button class="filter-btn" data-group="Melodiezauberer">‚ú® Melodiezauberer</button>
  <button class="filter-btn" data-group="Musikwichtel">üéµ Musikwichtel</button>
</nav>
</header>
<main id="main"></main>
<footer>¬© Kita ¬∑ Stand: 2025 ¬∑ Zeitzone: <strong>Europe/Berlin</strong></footer>

<script>
/* --- events data --- */
const events = [
{ title: "Neujahrskonzert", start: "2025-01-25T15:00:00", end: "2025-01-25T17:00:00" },
{ title: "Elternabend Fl√∂tenfohlen", start: "2025-02-05T18:00:00", end: "2025-02-05T19:00:00" },
{ title: "Elternabend Trompetentiger", start: "2025-02-06T18:00:00", end: "2025-02-06T19:00:00" },
{ title: "Elternabend Klangkobolde", start: "2025-02-12T18:00:00", end: "2025-02-12T19:00:00" },
{ title: "Elternabend Klavierschildkr√∂ten", start: "2025-02-13T18:00:00", end: "2025-02-13T19:00:00" },
{ title: "Elternrat", start: "2025-02-19T18:00:00", end: "2025-02-19T19:00:00" },
{ title: "Fasching", start: "2025-02-19", end: "2025-02-19" },
{ title: "Kita geschlossen! Konzepttag", start: "2025-02-21", end: "2025-02-21" },
{ title: "Elternabend Melodiezauberer", start: "2025-02-27T18:00:00", end: "2025-02-27T19:00:00" },
{ title: "Elternabend Musikwichtel", start: "2025-03-06T18:00:00", end: "2025-03-06T19:00:00" },
{ title: "Kita geschlossen! Konzepttag", start: "2025-04-07", end: "2025-04-07" },
{ title: "Kita geschlossen! Regenerationstag", start: "2025-05-02", end: "2025-05-02" },
{ title: "Elternrat", start: "2025-05-21T18:00:00", end: "2025-05-21T19:00:00" },
{ title: "Kita geschlossen! Betriebsausflug", start: "2025-06-20", end: "2025-06-20" },
{ title: "Sommerfest (Betreuung bis 13 Uhr)", start: "2025-06-27T15:00:00", end: "2025-06-27T17:00:00" },
{ title: "Verabschiedung Br√ºckenjahr", start: "2025-07-04", end: "2025-07-04" },
{ title: "Kita geschlossen! Sommerschlie√üzeit", start: "2025-08-04", end: "2025-08-15" },
{ title: "Elternabend Fl√∂tenfohlen", start: "2025-09-10T18:00:00", end: "2025-09-10T19:00:00" },
{ title: "Elternabend Trompetentiger", start: "2025-09-11T18:00:00", end: "2025-09-11T19:00:00" },
{ title: "Elternabend Klavierschildkr√∂ten", start: "2025-09-17T18:00:00", end: "2025-09-17T19:00:00" },
{ title: "Elternabend Melodiezauberer & Musikwichtel & Klangkobolde", start: "2025-09-18T18:00:00", end: "2025-09-18T19:00:00" },
{ title: "Elternrat", start: "2025-09-24T18:00:00", end: "2025-09-24T19:00:00" },
{ title: "Kita geschlossen! Tag der mittelbaren P√§dagogik", start: "2025-09-26", end: "2025-09-26" },
{ title: "Kita geschlossen! Regenerationstag", start: "2025-10-06", end: "2025-10-06" },
{ title: "Herbstbasteln Klavierschildkr√∂ten", start: "2025-11-04T15:00:00", end: "2025-11-04T17:00:00" },
{ title: "Herbstbasteln Trompetentiger", start: "2025-11-05T15:00:00", end: "2025-11-05T17:00:00" },
{ title: "Herbstbasteln Fl√∂tenfohlen", start: "2025-11-06T15:00:00", end: "2025-11-06T17:00:00" },
{ title: "Info-Nachmittag Br√ºckenjahr", start: "2025-11-11T15:00:00", end: "2025-11-11T17:00:00" },
{ title: "Elternrat", start: "2025-11-12T18:00:00", end: "2025-11-12T19:00:00" },
{ title: "Kita geschlossen! Tag der Hamburger Richtlinien", start: "2025-11-14", end: "2025-11-14" },
{ title: "Lichterfest", start: "2025-11-21T18:00:00", end: "2025-11-21T19:00:00" },
{ title: "Adventssingen Musikwichtel & Klavierschildkr√∂ten", start: "2025-12-09T18:00:00", end: "2025-12-09T19:00:00" },
{ title: "Adventssingen Melodiezauberer & Fl√∂tenfohlen", start: "2025-12-10T18:00:00", end: "2025-12-10T19:00:00" },
{ title: "Adventssingen Klangkobolde & Trompetentiger", start: "2025-12-11T18:00:00", end: "2025-12-11T19:00:00" },
{ title: "Kita geschlossen! Winterschlie√üzeit", start: "2025-12-24", end: "2026-01-02" }
];

/* groups to filter by */
const groups = ["Klavierschildkr√∂ten","Klangkobolde","Trompetentiger","Fl√∂tenfohlen","Melodiezauberer","Musikwichtel"];

/* helpers */
function toDate(s){ return s.includes("T") ? new Date(s) : new Date(s + "T00:00:00"); }
function monthKey(dt){ return dt.toLocaleString("de-DE",{ month:"long", year:"numeric" }); }
events.sort((a,b)=> toDate(a.start) - toDate(b.start));
const months = {};
events.forEach(ev=>{
  const key = monthKey(toDate(ev.start));
  months[key] = months[key] || [];
  months[key].push(ev);
});

/* determine which groups an event applies to */
function eventGroups(ev){
  const title = ev.title.toLowerCase();
  const matched = groups.filter(g => title.includes(g.toLowerCase()));
  return matched.length ? matched : ["all"];
}

/* display formatting */
function displayDateRange(ev){
  const s = toDate(ev.start), e = toDate(ev.end);
  if(s.toDateString() === e.toDateString()){
    return s.toLocaleDateString("de-DE",{ weekday:"short", day:"2-digit", month:"2-digit", year:"numeric" });
  } else {
    const from = s.toLocaleDateString("de-DE",{ day:"2-digit", month:"2-digit", year:"numeric" });
    const to = e.toLocaleDateString("de-DE",{ day:"2-digit", month:"2-digit", year:"numeric" });
    return `${from} ‚Äì ${to}`;
  }
}
function displayTime(ev){
  if(ev.start.includes("T")){
    return `${toDate(ev.start).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})} ‚Äì ${toDate(ev.end).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}`;
  } else return "ganzt√§gig";
}

/* ICS helpers (Europe/Berlin) */
function pad(n){ return n.toString().padStart(2,"0"); }
function toICSDateTimeLocal(s){
  if(!s.includes("T")) return s.replace(/-/g,"");
  const d = new Date(s);
  const y=d.getFullYear(), mo=pad(d.getMonth()+1), da=pad(d.getDate()), hh=pad(d.getHours()), mm=pad(d.getMinutes()), ss=pad(d.getSeconds());
  return `${y}${mo}${da}T${hh}${mm}${ss}`;
}
function utcNowICS(){ return toICSDateTimeLocal(new Date().toISOString()); }

/* create VEVENT with VALARM 2 days before */
function createVEvent(ev){
  const uid = `${Date.now()}-${Math.random().toString(36).slice(2,9)}@kitatermine.local`;
  const dtstamp = utcNowICS();
  
  if(!ev.start.includes("T")){
    const startY = ev.start.replace(/-/g,"");
    const startDate = new Date(ev.start + "T00:00:00");
    const endDate = new Date(ev.end + "T00:00:00");

    // +1 Tag nur, wenn ganzt√§giger Termin l√§nger als 1 Tag dauert
    if ((endDate - startDate) > 24*60*60*1000) {
      endDate.setDate(endDate.getDate() + 1);
    }

    const endY = endDate.toISOString().slice(0,10).replace(/-/g,"");

    return [
      "BEGIN:VEVENT",
      `UID:${uid}`,
      `DTSTAMP:${dtstamp}`,
      `DTSTART;VALUE=DATE:${startY}`,
      `DTEND;VALUE=DATE:${endY}`,
      `SUMMARY:${ev.title}`,
      "BEGIN:VALARM",
      "TRIGGER:-P2D",
      "ACTION:DISPLAY",
      "DESCRIPTION:Erinnerung: Termin in 2 Tagen",
      "END:VALARM",
      "END:VEVENT"
    ].join("\r\n");

  } else {
    const dtStart = toICSDateTimeLocal(ev.start);
    const dtEnd = toICSDateTimeLocal(ev.end);
    return [
      "BEGIN:VEVENT",
      `UID:${uid}`,
      `DTSTAMP:${dtstamp}`,
      `DTSTART;TZID=Europe/Berlin:${dtStart}`,
      `DTEND;TZID=Europe/Berlin:${dtEnd}`,
      `SUMMARY:${ev.title}`,
      "BEGIN:VALARM",
      "TRIGGER:-P2D",
      "ACTION:DISPLAY",
      "DESCRIPTION:Erinnerung: Termin in 2 Tagen",
      "END:VALARM",
      "END:VEVENT"
    ].join("\r\n");
  }
}

/* build global ICS */
function buildGlobalICS(){ 
  return ["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Kita-Termine//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH",events.map(createVEvent).join("\r\n"),"END:VCALENDAR"].join("\r\n"); 
}

/* per-event ICS data URL */
function buildEventICSDataUrl(ev){ 
  const content = ["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Kita-Termine//DE",createVEvent(ev),"END:VCALENDAR"].join("\r\n");
  return "data:text/calendar;charset=utf-8," + encodeURIComponent(content);
}


/* Google link */
function buildGoogleUrl(ev){
  if(!ev.start.includes("T")){
    // Ganzt√§giger Termin
    const startY = ev.start.replace(/-/g,"");
    const startDate = new Date(ev.start + "T00:00:00");
    const endDate = new Date(ev.end + "T00:00:00");

// +1 Tag nur, wenn Termin l√§nger als 1 Tag dauert
if ((endDate - startDate) > 24*60*60*1000) {
  endDate.setDate(endDate.getDate() + 1);
}

const endY = endDate.toISOString().slice(0,10).replace(/-/g,"");

    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title)}&dates=${startY}/${endY}&ctz=Europe/Berlin&details=${encodeURIComponent("Erinnerung: bitte 2 Tage vorher setzen")}`;
  } else {
    // Termin mit Uhrzeit
    const s = toICSDateTimeLocal(ev.start);
    const e = toICSDateTimeLocal(ev.end);
    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title)}&dates=${s}/${e}&ctz=Europe/Berlin&details=${encodeURIComponent("Erinnerung: bitte 2 Tage vorher setzen")}`;
  }
}

/* type metadata */
const typeMeta = {
  parents: { label:"Elternabend", cls:"type-parents", emoji:"üë©‚Äçüè´" },
  closed: { label:"Kita geschlossen", cls:"type-closed", emoji:"üö´" },
  party: { label:"Fest / Basteln", cls:"type-party", emoji:"üéâ" },
  info: { label:"Elternrat / Info", cls:"type-info", emoji:"üë•" },
  other: { label:"Sonstiges", cls:"type-other", emoji:"‚ú®" }
};
function detectType(title){
  const t = title.toLowerCase();
  if(t.includes("elternabend")) return "parents";
  if(t.includes("kita geschlossen")||t.includes("sommerschlie√üzeit")||t.includes("konzepttag")||t.includes("winterschlie√üzeit")||t.includes("regenerationstag")||t.includes("betriebsausflug")||t.includes("tag der")) return "closed";
  if(t.includes("fest")||t.includes("konzert")||t.includes("basteln")||t.includes("adventssingen")||t.includes("licht")||t.includes("sommerfest")||t.includes("verabschiedung")) return "party";
  if(t.includes("elternrat")||t.includes("info")) return "info";
  return "other";
}

/* RENDER */
const main = document.getElementById("main");
Object.keys(months).forEach(monthName=>{
  const section=document.createElement("section"); section.className="month";
  const h=document.createElement("h2");
  h.innerHTML=`<span class="dot" style="width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block;transform:translateY(1px)"></span> ${monthName.charAt(0).toUpperCase()+monthName.slice(1)}`;
  section.appendChild(h);
  const grid=document.createElement("div"); grid.className="grid";
  months[monthName].forEach(ev=>{
    const evGroups=eventGroups(ev);
    const card=document.createElement("article"); card.className="card"; card.dataset.groups=evGroups.join(",");
    const metaRow=document.createElement("div"); metaRow.className="row";
    const left=document.createElement("div"); left.style.flex="1";
    const title=document.createElement("div"); title.className="title"; title.textContent=ev.title;
    const date=document.createElement("div"); date.className="meta"; date.textContent=displayDateRange(ev);
    left.appendChild(title); left.appendChild(date);
    const right=document.createElement("div"); right.style.textAlign="right";
    const typ=detectType(ev.title); const tm=typeMeta[typ]||typeMeta.other;
    const pill=document.createElement("div"); pill.className="pill " + tm.cls;
    pill.innerHTML=`<span style="font-size:1.05rem">${tm.emoji}</span> <span style="opacity:0.95">${tm.label}</span>`;
    right.appendChild(pill); metaRow.appendChild(left); metaRow.appendChild(right);
    const timeRow=document.createElement("div"); timeRow.className="row";
    const timeDiv=document.createElement("div"); timeDiv.className="time"; timeDiv.textContent=displayTime(ev);
    timeRow.appendChild(timeDiv);
    const buttons=document.createElement("div"); buttons.className="buttons";
    const aIcal=document.createElement("a"); aIcal.className="btn btn-ical"; aIcal.href=buildEventICSDataUrl(ev);
    aIcal.setAttribute("download", ev.title.replace(/[^\w\d\-_]+/g,"_") + ".ics"); aIcal.innerHTML="üìÖ iCal";
    const aGoogle=document.createElement("a"); aGoogle.className="btn btn-google"; aGoogle.href=buildGoogleUrl(ev);
    aGoogle.target="_blank"; aGoogle.rel="noopener noreferrer"; aGoogle.innerHTML="üìÜ Google";
    buttons.appendChild(aIcal); buttons.appendChild(aGoogle);
    card.appendChild(metaRow); card.appendChild(timeRow); card.appendChild(buttons);
    grid.appendChild(card);
  });
  section.appendChild(grid); main.appendChild(section);
});

/* filters */
const filterButtons = document.querySelectorAll(".filter-btn");
filterButtons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    filterButtons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active"); // dunkel hervorgehoben
    const g = btn.dataset.group;
    filterByGroup(g);
  });
});
function filterByGroup(group){
  const cards=document.querySelectorAll(".card");
  cards.forEach(c=>{
    const gs=c.dataset.groups.split(",");
    if(group==="all" || gs.includes("all") || gs.map(x=>x.toLowerCase()).includes(group.toLowerCase())){
      c.style.display="";
    } else c.style.display="none";
  });
}

/* global ICS download link */
const globalICS=buildGlobalICS();
const dataUrl="data:text/calendar;charset=utf-8,"+encodeURIComponent(globalICS);
const feedLink=document.getElementById("feed-download");
feedLink.href=dataUrl; feedLink.setAttribute("download","kita_termine_2025.ics");

console.info("Hinweis: iCal-Dateien enthalten VALARM (2 Tage vorher). Google-Kalender-Links enthalten 'ctz=Europe/Berlin' und einen Hinweis f√ºr manuelle Erinnerung.");
</script>
</body>
</html>
