<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kita Finkenau – Termine 2026</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f8fafc;
      margin: 0;
      padding: 40px;
      color: #222;
    }
    h1, h2, h3 {
      text-align: center;
    }
    section {
      margin-top: 40px;
    }
    .event {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 16px 20px;
      margin: 10px auto;
      max-width: 600px;
    }
    .title {
      font-weight: 600;
      margin-bottom: 6px;
    }
    .date {
      color: #444;
      font-size: 0.95em;
      margin-bottom: 4px;
    }
    .groups {
      font-size: 0.85em;
      color: #777;
    }
    .btn {
      display: inline-block;
      text-decoration: none;
      background: #2563eb;
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.9em;
      margin: 4px;
      transition: 0.2s;
    }
    .btn:hover {
      background: #1e40af;
    }
    .btn-google { background: #34a853; }
    .btn-outlook { background: #0078d4; }
    .btn-ical { background: #f97316; }
    .btn-zip { background: #0f172a; }
    section.downloads {
      text-align: center;
      margin-top: 50px;
    }
  </style>
</head>
<body>
  <h1>Kita Finkenau – Termine 2026</h1>
  <div id="events"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    const groups = [
      "Klavierschildkröten",
      "Klangkobolde",
      "Trompetentiger",
      "Flötenfohlen",
      "Melodiezauberer",
      "Musikwichtel"
    ];

    const events = [
      { title: "Kita geschlossen! Sommerschließzeit", start: "2026-07-20", end: "2026-08-01" },
      { title: "Kita geschlossen! Winterschließzeit", start: "2026-12-24", end: "2027-01-02" },
      { title: "Elternabend Klavierschildkröten", start: "2026-03-10", end: "2026-03-11" },
      { title: "Sommerfest (alle Gruppen)", start: "2026-06-15", end: "2026-06-16" },
      { title: "Fototermin Klangkobolde", start: "2026-05-08", end: "2026-05-09" }
    ];

    function toDate(str){ return new Date(str + "T00:00:00"); }

    function displayDateRange(ev){
      const s = toDate(ev.start);
      let e = toDate(ev.end);
      if (ev.title.includes("Sommerschließzeit") || ev.title.includes("Winterschließzeit")) {
        e = new Date(e);
        e.setDate(e.getDate() - 1);
      }
      if (s.toDateString() === e.toDateString())
        return s.toLocaleDateString("de-DE", { weekday: "short", day: "2-digit", month: "2-digit", year: "numeric" });
      return `${s.toLocaleDateString("de-DE", { weekday: "short", day: "2-digit", month: "2-digit", year: "numeric" })} – ${e.toLocaleDateString("de-DE", { weekday: "short", day: "2-digit", month: "2-digit", year: "numeric" })}`;
    }

    function eventGroups(ev){
      const t = ev.title.toLowerCase();
      const gs = [];
      for (const g of groups) {
        if (t.includes(g.toLowerCase())) gs.push(g);
      }
      if (t.includes("alle")) gs.push("all");
      if (gs.length === 0) gs.push("all");
      return gs;
    }

    function createVEvent(ev){
      const uid = ev.title.replace(/\s+/g, "_") + "@" + ev.start;
      return [
        "BEGIN:VEVENT",
        "UID:" + uid,
        "SUMMARY:" + ev.title,
        "DTSTART;VALUE=DATE:" + ev.start.replace(/-/g,""),
        "DTEND;VALUE=DATE:" + ev.end.replace(/-/g,""),
        "DESCRIPTION:Kita Finkenau Termin",
        "BEGIN:VALARM",
        "TRIGGER:-P2D",
        "ACTION:DISPLAY",
        "DESCRIPTION:Erinnerung: " + ev.title,
        "END:VALARM",
        "END:VEVENT"
      ].join("\r\n");
    }

    function buildGroupICS(groupName) {
      const groupEvents = events.filter(ev => {
        const gs = eventGroups(ev);
        return gs.includes("all") || gs.includes(groupName);
      });
      const vevents = groupEvents.map(createVEvent).join("\r\n");
      return [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//Kita-Finkenau//DE",
        "CALSCALE:GREGORIAN",
        "METHOD:PUBLISH",
        vevents,
        "END:VCALENDAR"
      ].join("\r\n");
    }

    // Anzeige
    const container = document.getElementById("events");
    events.forEach(ev => {
      const div = document.createElement("div");
      div.className = "event";
      div.innerHTML = `
        <div class="title">${ev.title}</div>
        <div class="date">${displayDateRange(ev)}</div>
        <div class="groups">📘 ${eventGroups(ev).join(", ")}</div>
      `;
      container.appendChild(div);
    });

    /* Kalender-Download- und Abo-Links */
    const footerLinks = document.createElement("section");
    footerLinks.className = "downloads";

    const allLabel = document.createElement("h3");
    allLabel.textContent = "📂 Kalender-Downloads & Abo-Links";
    footerLinks.appendChild(allLabel);

    const allGroups = ["all", ...groups];
    const baseIcsUrl = "https://example.com/kita-ics/"; // ← anpassen

    allGroups.forEach(g => {
      const ics = buildGroupICS(g === "all" ? "all" : g);
      const filename = (g === "all" ? "kita_termine_2026_alle" : `kita_termine_2026_${g.toLowerCase().replace(/ /g,"_")}`) + ".ics";
      const dataUrl = "data:text/calendar;charset=utf-8," + encodeURIComponent(ics);
      const fileUrl = baseIcsUrl + filename;

      const wrapper = document.createElement("div");
      wrapper.style.margin = "16px auto";
      wrapper.style.display = "inline-block";
      wrapper.style.textAlign = "left";
      wrapper.style.border = "1px solid rgba(0,0,0,0.05)";
      wrapper.style.borderRadius = "12px";
      wrapper.style.padding = "12px 20px";
      wrapper.style.background = "white";
      wrapper.style.boxShadow = "0 4px 10px rgba(0,0,0,0.05)";

      const title = document.createElement("div");
      title.style.fontWeight = "700";
      title.style.marginBottom = "8px";
      title.textContent = g === "all" ? "🌍 Alle Gruppen" : `📅 ${g}`;
      wrapper.appendChild(title);

      const btnIcal = document.createElement("a");
      btnIcal.href = dataUrl;
      btnIcal.download = filename;
      btnIcal.className = "btn btn-ical";
      btnIcal.textContent = "💾 iCal herunterladen";
      btnIcal.style.display = "block";
      btnIcal.style.marginBottom = "4px";
      wrapper.appendChild(btnIcal);

      const btnGoogle = document.createElement("a");
      btnGoogle.href = `https://calendar.google.com/calendar/u/0/r?cid=${encodeURIComponent(fileUrl)}`;
      btnGoogle.target = "_blank";
      btnGoogle.className = "btn btn-google";
      btnGoogle.textContent = "🌐 In Google Kalender abonnieren";
      btnGoogle.style.display = "block";
      btnGoogle.style.marginBottom = "4px";
      wrapper.appendChild(btnGoogle);

      const btnOutlook = document.createElement("a");
      btnOutlook.href = `https://outlook.live.com/owa/?path=/calendar/action/compose&rru=addsubscription&url=${encodeURIComponent(fileUrl)}&name=${encodeURIComponent("Kita " + (g === "all" ? "Alle Gruppen" : g))}`;
      btnOutlook.target = "_blank";
      btnOutlook.className = "btn btn-outlook";
      btnOutlook.textContent = "📅 In Outlook abonnieren";
      btnOutlook.style.display = "block";
      wrapper.appendChild(btnOutlook);

      footerLinks.appendChild(wrapper);
    });

    // ZIP-Export-Button
    const zipBtn = document.createElement("button");
    zipBtn.textContent = "📦 Alle ICS-Dateien als ZIP herunterladen";
    zipBtn.className = "btn btn-zip";
    zipBtn.style.marginTop = "30px";
    zipBtn.onclick = async () => {
      const zip = new JSZip();
      allGroups.forEach(g => {
        const ics = buildGroupICS(g === "all" ? "all" : g);
        const filename = (g === "all" ? "kita_termine_2026_alle" : `kita_termine_2026_${g.toLowerCase().replace(/ /g,"_")}`) + ".ics";
        zip.file(filename, ics);
      });
      const blob = await zip.generateAsync({ type: "blob" });
      saveAs(blob, "kita_termine_2026_ics.zip");
    };
    footerLinks.appendChild(zipBtn);

    document.body.appendChild(footerLinks);
  </script>
</body>
</html>
