<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kita-Termine 2025</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0077b6;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: #e0e0e0;
      padding: 0.5rem;
      gap: 0.5rem;
    }
    nav button {
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.4rem 1rem;
      cursor: pointer;
      transition: 0.2s;
    }
    nav button:hover {
      background: #d7e8ff;
    }
    nav button.active {
      background: #0077b6;
      color: white;
      font-weight: bold;
    }
    table {
      width: 95%;
      margin: 1rem auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.75rem;
      border-bottom: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #f1f1f1;
    }
    a.button {
      display: inline-block;
      margin: 0 5px;
      padding: 0.3rem 0.6rem;
      background: #0077b6;
      color: white;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    a.button:hover {
      background: #005f8a;
    }
  </style>
</head>
<body>
  <header>
    <h1>Kita-Termine 2025</h1>
  </header>

  <nav>
    <button class="active" onclick="filterEvents('alle')">Alle Gruppen</button>
    <button onclick="filterEvents('Klavierschildkr√∂ten')">Klavierschildkr√∂ten</button>
    <button onclick="filterEvents('Klangkobolde')">Klangkobolde</button>
    <button onclick="filterEvents('Trompetentiger')">Trompetentiger</button>
    <button onclick="filterEvents('Fl√∂tenfohlen')">Fl√∂tenfohlen</button>
    <button onclick="filterEvents('Melodiezauberer')">Melodiezauberer</button>
    <button onclick="filterEvents('Musikwichtel')">Musikwichtel</button>
  </nav>

  <table id="termine">
    <thead>
      <tr>
        <th>Von</th>
        <th>Bis</th>
        <th>Uhrzeit</th>
        <th>Termin</th>
        <th>Kalender</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const termine = [
      {von: "2025-01-25", bis: "2025-01-25", zeit: "15:00-17:00", titel: "Neujahrskonzert"},
      {von: "2025-02-05", bis: "2025-02-05", zeit: "18:00-19:00", titel: "Elternabend Fl√∂tenfohlen"},
      {von: "2025-02-06", bis: "2025-02-06", zeit: "18:00-19:00", titel: "Elternabend Trompetentiger"},
      {von: "2025-02-12", bis: "2025-02-12", zeit: "18:00-19:00", titel: "Elternabend Klangkobolde"},
      {von: "2025-02-13", bis: "2025-02-13", zeit: "18:00-19:00", titel: "Elternabend Klavierschildkr√∂ten"},
      {von: "2025-02-19", bis: "2025-02-19", zeit: "18:00-19:00", titel: "Elternrat"},
      {von: "2025-02-19", bis: "2025-02-19", zeit: "ganzt√§gig", titel: "Fasching"},
      {von: "2025-02-21", bis: "2025-02-21", zeit: "ganzt√§gig", titel: "Kita geschlossen! Konzepttag"},
      {von: "2025-04-07", bis: "2025-04-07", zeit: "ganzt√§gig", titel: "Kita geschlossen! Konzepttag"},
      {von: "2025-08-04", bis: "2025-08-15", zeit: "ganzt√§gig", titel: "Kita geschlossen! Sommerschlie√üzeit"},
      {von: "2025-12-24", bis: "2026-01-02", zeit: "ganzt√§gig", titel: "Kita geschlossen! Winterschlie√üzeit"}
    ];

    function createICS(von, bis, titel, beschreibung) {
      const start = formatDateICS(von);
      const end = formatDateICS(addOneDay(bis)); // Endtag inklusive
      const reminder = `
BEGIN:VALARM
TRIGGER:-P2D
DESCRIPTION:Erinnerung
ACTION:DISPLAY
END:VALARM`;
      return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Kita Termine//DE
BEGIN:VEVENT
SUMMARY:${titel}
DESCRIPTION:${beschreibung}
DTSTART;TZID=Europe/Berlin:${start}
DTEND;TZID=Europe/Berlin:${end}${reminder}
END:VEVENT
END:VCALENDAR`;
    }

    function formatDateICS(date) {
      const d = new Date(date);
      return d.toISOString().replace(/[-:]/g, "").split(".")[0];
    }

    function addOneDay(dateStr) {
      const d = new Date(dateStr);
      d.setDate(d.getDate() + 1);
      return d;
    }

    function createGoogleLink(von, bis, titel, beschreibung) {
      const start = formatDateICS(von);
      const end = formatDateICS(addOneDay(bis));
      const details = encodeURIComponent(beschreibung + "\n\nüîî Erinnerung: 2 Tage vor dem Termin");
      return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(titel)}&dates=${start}/${end}&details=${details}&ctz=Europe/Berlin`;
    }

    function renderTable(filter = "alle") {
      const tbody = document.querySelector("#termine tbody");
      tbody.innerHTML = "";

      termine.forEach(event => {
        const gruppen = ["Klavierschildkr√∂ten", "Klangkobolde", "Trompetentiger", "Fl√∂tenfohlen", "Melodiezauberer", "Musikwichtel"];
        const betrifftAlle = !gruppen.some(g => event.titel.includes(g));
        if (filter === "alle" || event.titel.includes(filter) || betrifftAlle) {
          const beschreibung = `${event.titel} ‚Äì Erinnerung: 2 Tage vor dem Termin`;
          const ics = createICS(event.von, event.bis, event.titel, beschreibung);
          const google = createGoogleLink(event.von, event.bis, event.titel, beschreibung);

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${event.von}</td>
            <td>${event.bis}</td>
            <td>${event.zeit}</td>
            <td>${event.titel}</td>
            <td>
              <a href="data:text/calendar;charset=utf-8,${encodeURIComponent(ics)}" download="${event.titel}.ics" class="button">iCal</a>
              <a href="${google}" target="_blank" class="button">Google</a>
            </td>`;
          tbody.appendChild(row);
        }
      });
    }

    function filterEvents(gruppe) {
      renderTable(gruppe);
      document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
      const activeBtn = [...document.querySelectorAll("nav button")].find(btn => btn.textContent.includes(gruppe === 'alle' ? 'Alle' : gruppe));
      if (activeBtn) activeBtn.classList.add("active");
    }

    renderTable();
  </script>
</body>
</html>
